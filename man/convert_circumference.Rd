% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_preprocessing.R
\name{convert_circumference}
\alias{convert_circumference}
\title{Harmonize C130 and C150 Using Species-Specific Conversion Models}
\usage{
convert_circumference(
  x,
  D150 = "D150",
  D130 = "D130",
  C150 = "C150",
  C130 = "C130",
  HTOT = "HTOT",
  HDOM = "HDOM"
)
}
\arguments{
\item{x}{A \code{data.frame} containing at least a \code{Species} column and either \code{C130} or \code{C150}.}

\item{D150}{Character. Name of the column for diameter at 150 cm (default: \code{"D150"}).}

\item{D130}{Character. Name of the column for diameter at 130 cm (default: \code{"D130"}).}

\item{C150}{Character. Name of the column for circumference at 150 cm (default: \code{"C150"}).}

\item{C130}{Character. Name of the column for circumference at 130 cm (default: \code{"C130"}).}

\item{HTOT}{Character. Column name for total tree height (not used here but passed for consistency).}

\item{HDOM}{Character. Column name for dominant height (not used here but passed for consistency).}
}
\value{
A \code{data.frame} with harmonized \code{C130} and/or \code{C150} columns and updated diameters
\code{D130} and \code{D150} derived from the converted circumferences.
}
\description{
Converts between circumference at 130 cm and 150 cm above ground using linear models
derived from species-specific calibration coefficients. The formula used is:
\eqn{C_{target} = HV \cdot C_{source} + IV}, where \eqn{HV} and \eqn{IV} are parameters
retrieved from an internal equations table.
}
\details{
The direction of conversion is automatically inferred based on which of \code{C130} or \code{C150} is missing.
If both are available, a bidirectional check is performed. The species-specific coefficients \code{HV} and \code{IV}
must be available in a global object named \code{equations}.
}
\examples{
\dontrun{
# --- Species-specific C130 <-> C150 conversion with HV/IV per species ---

# Input data: one missing C130 (will compute from C150), one missing C150
df <- data.frame(
  Species = c("Hetre", "Chene sessile"),
  C130    = c(NA,     120),   # missing for Hetre, present for Chene sessile
  C150    = c(105,    NA),    # present for Hetre, missing for Chene sessile
  D130    = NA_real_,         # will be recomputed from C130
  D150    = NA_real_,         # will be recomputed from C150
  HTOT    = c(25, 28),
  HDOM    = c(27, 30),
  stringsAsFactors = FALSE
)

# Run circumference harmonization (species-specific HV/IV are used)
df_conv <- convert_circumference(df, C130 = "C130", C150 = "C150",
                                 D130 = "D130", D150 = "D150")
head(df_conv)

# After this call:
# - For Hetre: C130 = HV * C150 + IV  => 0.97*105 + 1.5, and D130 = C130 / pi
# - For Chene sessile: C150 = (C130 - IV) / HV, and D150 = C150 / pi

# Full pipeline via carbofor() on a plain data.frame:
res <- carbofor(
  x = df_conv,         # a standard data.frame is fine here; wrapper handles class
  volume_type = "V22",
  carbon = TRUE,
  bark = TRUE,
  specimens = "Species",
  biomass_method = "volume"
)
head(res)
}
}
\seealso{
\code{\link{diameter_conversions}}, \code{\link{calculate_basal_areas}}, \code{\link{preprocess_data}}
}
