% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Fonction.R
\name{calculate_volumes}
\alias{calculate_volumes}
\title{Calculate Tree Volumes Using Allometric Equations}
\usage{
calculate_volumes(
  df,
  volume_type = "V22",
  equation_id = 1,
  specimens = NULL,
  C130 = "C130",
  C150 = "C150",
  D130 = "D130",
  D150 = "D150",
  HTOT = "HTOT",
  HDOM = "HDOM",
  remove_na = FALSE
)
}
\arguments{
\item{df}{A data.frame containing tree measurements with columns for circumferences,
diameters, heights, and species identification.}

\item{volume_type}{Character string specifying the type of volume to calculate.
Must be one of: "V22", "V22B", "E", "V22_HA". Default is "V22".}

\item{equation_id}{Integer specifying which equation to use within the volume type.
Valid values depend on volume_type:
\itemize{
  \item For "V22": 1, 2, or 3
  \item For "V22_HA": 1 only
  \item For "V22B": 1 only
  \item For "E": automatically determined (4 or 5) based on species
}
Default is 1.}

\item{specimens}{Character string specifying the column name containing species
identification. Can be species codes, abbreviations, or full species names.
Default is NULL.}

\item{C130}{Character string specifying the column name for circumference at 1.30m.
Default is "C130".}

\item{C150}{Character string specifying the column name for circumference at 1.50m.
Default is "C150".}

\item{D130}{Character string specifying the column name for diameter at 1.30m.
Default is "D130".}

\item{D150}{Character string specifying the column name for diameter at 1.50m.
Default is "D150".}

\item{HTOT}{Character string specifying the column name for total height.
Default is "HTOT".}

\item{HDOM}{Character string specifying the column name for dominant height.
Default is "HDOM".}

\item{remove_na}{Logical indicating whether to remove rows with NA volume results.
Default is FALSE.}
}
\value{
A data.frame with the original data plus additional columns:
  \itemize{
    \item Species: Standardized species names
    \item C130/C150: Circumferences (converted from diameters if needed)
    \item D130/D150: Diameters (calculated from circumferences if needed)
    \item G130/G150: Basal areas (calculated from circumferences)
    \item Volume column named according to volume_type parameter
    \item Equation_Used: Information about which equation was applied
  }
}
\description{
This function calculates various types of tree volumes (V22, V22B, E, V22_HA) using
species-specific allometric equations. It handles data preprocessing including species
identification, diameter/circumference conversions, and basal area calculations.
}
\details{
The function performs several preprocessing steps:
\enumerate{
  \item \strong{Parameter validation}: Checks input parameters and data structure
  \item \strong{Species correspondence}: Maps species codes/abbreviations to full names
  \item \strong{Unit conversions}: Converts between diameters and circumferences using pi
  \item \strong{Basal area calculation}: Computes G = C²/(4pi*10000)
  \item \strong{Volume calculation}: Applies species-specific allometric equations
}

\strong{Volume Types:}
\itemize{
  \item \strong{V22}: Standard volume equations with linear combinations
  \item \strong{V22B}: Specific biomass-related volume calculations
  \item \strong{E}: Logarithmic equations (A0=4: log₁₀ form, A0=5: alternative)
  \item \strong{V22_HA}: Height-adjusted volume calculations
}

\strong{Species Identification:}
The function automatically detects the type of species identification:
\itemize{
  \item \strong{Code}: Numeric species codes
  \item \strong{Abr}: Character abbreviations (≤4 characters)
  \item \strong{Species}: Full species names (>4 characters)
}

\strong{Equation Types (A0 parameter):}
\itemize{
  \item \strong{A0 = 1, 2, 3, 5}: Linear equations of form: Volume = b0 + Σ(bᵢ * Xi)
  \item \strong{A0 = 4}: Logarithmic equations: Volume = 10^(b0 + b₁ * log₁₀(C130))
}
}
\note{
The function displays information messages during execution to facilitate debugging.
Warnings are issued if species correspondences are not found or if
volume calculation fails for certain rows.
}
\section{Dependencies}{

This function requires access to a global \code{equations} data.frame containing:
\itemize{
  \item Species: Species names
  \item Y: Volume type identifier
  \item A0: Equation type identifier
  \item b0-b5: Equation coefficients
  \item X1-X5: Variable expressions
  \item HV, IV: Conversion coefficients for circumference transformations
  \item Code, Abr: Species identification mappings
}
}

\section{Warning Messages}{

The function provides extensive debugging output and warnings for:
\itemize{
  \item Missing or invalid data
  \item Failed conversions
  \item Missing species correspondences
  \item Equation evaluation errors
  \item Invalid mathematical operations (e.g., log of negative values)
}
}

\examples{
\dontrun{
# Basic usage with circumference data
data <- data.frame(
  Species = c("Picea abies", "Fagus sylvatica", "Quercus robur"),
  C130 = c(94.2, 125.6, 157.1),
  HTOT = c(25.5, 28.2, 22.8)
)

result <- calculate_volumes(data, volume_type = "V22", equation_id = 1)

# Using diameter data with automatic conversion
data_diam <- data.frame(
  Code = c(1, 2, 3),
  D130 = c(30, 40, 50),
  HTOT = c(25, 28, 23)
)

result <- calculate_volumes(data_diam,
                          volume_type = "V22B",
                          specimens = "Code")

# Volume type E with automatic equation selection
result_E <- calculate_volumes(data, volume_type = "E")

# Remove rows with failed calculations
result_clean <- calculate_volumes(data,
                                volume_type = "V22_HA",
                                remove_na = TRUE)
}

}
\references{
Dagnelie, P., Rondeux, J., & Thill, A. (1985). Tables de cubage des arbres et des peuplements forestiers. Gembloux, Belgique: Presses agronomiques de Gembloux.
}
\seealso{
Related functions for forest management and dendrometric calculations.
}
\author{
Caussin Antonin
}
