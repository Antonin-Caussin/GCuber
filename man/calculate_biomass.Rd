% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculations.R
\name{calculate_biomass}
\alias{calculate_biomass}
\title{Calculate forest biomass using allometric equations or volume* density}
\usage{
calculate_biomass(x, equations, method = c("equation", "volume"), bark = FALSE)
}
\arguments{
\item{x}{A `data.frame` containing tree-level input data. Must include a `Species` column. Depending on the method:
- For `"volume"`: must include one or more volume columns (e.g., `"V22"`, `"Aboveground"`), or `Wood Volume` and `Bark Volume` if `bark = TRUE`.
- For `"equation"`: must include the predictor variables required by the selected equations (e.g., `D130`, `HTOT`, etc.).}

\item{equations}{A `data.frame` of allometric equations. Depending on the method:
- For `"volume"`: must contain columns `Species` and `ID` (infra-density in g/cm^3).
- For `"equation"`: must contain `Species`, `Y`, `A0`, `b0`-`b5`, `X0`-`X5`, and optionally `Type_Eq`, `Region`.}

\item{method}{Character string. Method to use for biomass estimation:
- `"equation"`: uses allometric models.
- `"volume"`: uses volume* density. Default is `"volume"`.}

\item{bark}{Logical. If `TRUE` and `method = "volume"`, computes biomass using both `Wood Volume` and `Bark Volume`. Default is `FALSE`.}
}
\value{
A modified version of `x` with added biomass columns:

- For `method = "equation"`:
  - One or more columns of the form `Biomass_<Type_Eq>` with aboveground biomass.
  - `Biomass Root`: root biomass (20% of total).
  - `Biomass Total`: total biomass (120% of aboveground).

- For `method = "volume"` and `bark = FALSE`:
  - One column of the form `Biomass_<VolumeType>` (e.g., `Biomass_V22`).
  - `Biomass Root`, `Biomass_Total`.

- For `method = "volume"` and `bark = TRUE`:
  - `Biomass_Wood`, `Biomass_Bark`, `Biomass_BarkWood`.
  - `Biomass Root`, `Biomass_Total`.
}
\description{
Computes aboveground biomass at the tree level using one of two methods:

- **`"equation"`**: applies species-specific allometric models provided in a reference table.
- **`"volume"`**: multiplies volume data (e.g., V22) by species-specific infra-density (`ID`), with optional bark volume integration.

When `method = "volume"` and `bark = TRUE`, the function uses `Wood Volume` and `Bark Volume` (typically from `calculate_bark_thickness()`) to estimate total biomass.

When `method = "equation"`, one or more equations are applied per species, with results stored in dynamically named columns by type of biomass (`Type_Eq`).

Root and total biomass are always computed as 20% and 120% of the aboveground biomass, respectively.
}
\details{
### Volume method
If `bark = FALSE`, the function uses the first available volume column among:
`V22`, `V22B`, `V22_HA`, `Sawlog`, `Aboveground`, `Merchantable`.
The selected volume is multiplied by `ID* 1000` (g/cm^3 to kg/m^3).

If `bark = TRUE`, the function uses both `Wood Volume` and `Bark Volume`, which must be present in `x`.

### Equation method
Equations are applied species-wise. Models are selected by `A0` value:

- `A0 = 15`: linear model using up to 3 predictors (e.g., `Y = b0*X0 + b1*X1 + b2*X2`)
- `A0 = 16`: semi-log model (e.g., `Y = b0*X0 + b1*log(X1)`)
- `A0 = 17`: power model (e.g., `Y = b0 * X0^b1`)

Expressions in `X0:X5` are evaluated dynamically using columns in `x`.

If the `Region` column equals `"Belgium"`, results are scaled by `Ã—1000`.
}
\seealso{
- [calculate_bark_thickness()] to compute `Wood Volume` and `Bark Volume`.
- [calculate_carbon()] to convert biomass into carbon stock.
- [calculate_volume()] for volume-based biomass estimation.
}
